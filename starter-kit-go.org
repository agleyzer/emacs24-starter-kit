#+TITLE: Starter Kit Go
#+OPTIONS: toc:nil num:nil ^:nil

* Starter kit Go

Support for the Go programming language.

** Dependencies

Determine whether required packages are installed. If not, use ELPA to
install them.

#+begin_src emacs-lisp
(starter-kit-install-if-needed 'flycheck 'go-mode 'key-chord 'yasnippet 'company)
#+end_src

** Environment

#+begin_src emacs-lisp

(setenv "GOPATH" (expand-file-name "~/Projects/go"))

(setenv "PATH" (concat (getenv "PATH") ":"
                       (substitute-in-file-name "$GOPATH/bin") ":"
                        "/usr/local/opt/go/libexec/bin"))

(setq exec-path (append exec-path (list
  (substitute-in-file-name "$GOPATH/bin") "/usr/local/opt/go/libexec/bin")))

#+end_src

** Flymake/Flycheck

#+begin_src emacs-lisp

(add-to-list 'load-path
             (substitute-in-file-name "$GOPATH/src/github.com/dougm/goflymake"))

;; https://github.com/dougm/goflymake/issues/7
(defcustom goflymake-debug nil
  "Enable failure debugging mode in goflymake."
  :type 'boolean
  :group 'goflymake)

(require 'go-flycheck)

#+end_src

** Hooks

#+begin_src emacs-lisp

(add-hook 'before-save-hook 'gofmt-before-save)

(add-hook 'go-mode-hook
          (lambda ()
            (require 'key-chord)
            (flycheck-mode 1)
            (setq tab-width 4)
            (key-chord-mode +1)
            (key-chord-define go-mode-map "ii" 'go-goto-imports)
            (key-chord-define go-mode-map "jj" 'godef-jump)
            (key-chord-define go-mode-map "dd" 'godef-describe)
            (local-set-key (kbd "M-.") 'godef-jump)))

#+end_src

** Speedbar support

#+begin_src emacs-lisp
(when (require 'speedbar)
   (speedbar-add-supported-extension ".go"))

;; (add-to-list 'speedbar-fetch-etags-parse-list
;;    '("\\.go" . speedbar-parse-c-or-c++tag))

#+end_src
** Auto complete
#+begin_src emacs-lisp

(add-to-list 'load-path
             (substitute-in-file-name "$GOPATH/src/github.com/nsf/gocode/emacs-company"))

(require 'company)                                   ; load company mode
(require 'company-go)                                ; load company mode go backend

(setq company-tooltip-limit 20)                      ; bigger popup window
(setq company-idle-delay .3)                         ; decrease delay before autocompletion popup shows
(setq company-echo-delay 0)                          ; remove annoying blinking
(setq company-begin-commands '(self-insert-command)) ; start autocompletion only after typing

(add-hook 'go-mode-hook (lambda ()
                          (set (make-local-variable 'company-backends) '(company-go))
                          (company-mode)))
#+end_src

